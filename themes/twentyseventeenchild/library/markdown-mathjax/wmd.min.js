var Attacklab=Attacklab||{};Attacklab.wmdBase=function(){var g=top.Attacklab,v=top.document,h=top.RegExp,T=top.navigator;g.Util={},g.Position={},g.Command={},g.Global={};var b=g.Util,w=g.Position,k=g.Command,x=g.Global;x.isIE=/msie/.test(T.userAgent.toLowerCase()),x.isIE_5or6=/msie 6/.test(T.userAgent.toLowerCase())||/msie 5/.test(T.userAgent.toLowerCase()),x.isIE_7plus=x.isIE&&!x.isIE_5or6,x.isOpera=/opera/.test(T.userAgent.toLowerCase()),x.isKonqueror=/konqueror/.test(T.userAgent.toLowerCase());g.PanelCollection=function(){this.buttonBar=v.getElementById("wmd-button-bar"),this.preview=v.getElementById("wmd-preview"),this.output=v.getElementById("wmd-output"),this.input=v.getElementById(MyWmdInput)},g.panels=void 0,g.ieCachedRange=null,g.ieRetardedClick=!1,b.isVisible=function(e){return window.getComputedStyle?"none"!==window.getComputedStyle(e,null).getPropertyValue("display"):e.currentStyle?"none"!==e.currentStyle.display:void 0},b.addEvent=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},b.removeEvent=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},b.fixEolChars=function(e){return e=(e=e.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")},b.extendRegExp=function(e,t,n){null==t&&(t=""),null==n&&(n="");var i=e.toString(),a="",o=i.match(/\/([gim]*)$/);return a=null===o?o[0]:"",i=t+(i=i.replace(/(^\/|\/[gim]*$)/g,""))+n,new RegExp(i,a)},b.createImage=function(e){var t="images/"+e,n=v.createElement("img");return n.className="wmd-button",n.src=t,n},b.prompt=function(a,o,n){var r,i,l;void 0===o&&(o="");var s=function(e){27===(e.charCode||e.keyCode)&&c(!0)},c=function(e){b.removeEvent(v.body,"keydown",s);var t=l.value;return e?t=null:-1===(t=(t=(t=t.replace("http://http://","http://")).replace("http://https://","https://")).replace("http://ftp://","ftp://")).indexOf("http://")&&-1===t.indexOf("ftp://")&&-1===t.indexOf("https://")&&(t="http://"+t),r.parentNode.removeChild(r),i.parentNode.removeChild(i),n(t),!1};!function(){(i=v.createElement("div")).className="wmd-prompt-background",style=i.style,style.position="absolute",style.top="0",style.zIndex="1000",x.isKonqueror?style.backgroundColor="transparent":x.isIE?style.filter="alpha(opacity=50)":style.opacity="0.5";var e=w.getPageSize();style.height=e[1]+"px",x.isIE?(style.left=v.documentElement.scrollLeft,style.width=v.documentElement.clientWidth):(style.left="0",style.width="100%"),v.body.appendChild(i)}(),top.setTimeout(function(){!function(){(r=v.createElement("div")).className="wmd-prompt-dialog",r.style.padding="10px;",r.style.position="fixed",r.style.width="400px",r.style.zIndex="1001";var e=v.createElement("div");e.innerHTML=a,e.style.padding="5px",r.appendChild(e);var t=v.createElement("form");t.onsubmit=function(){return c(!1)},style=t.style,style.padding="0",style.margin="0",style.cssFloat="left",style.width="100%",style.textAlign="center",style.position="relative",r.appendChild(t),(l=v.createElement("input")).type="text",l.value=o,style=l.style,style.display="block",style.width="80%",style.marginLeft=style.marginRight="auto",t.appendChild(l);var n=v.createElement("input");n.type="button",n.onclick=function(){return c(!1)},n.value="OK",style=n.style,style.margin="10px",style.display="inline",style.width="7em";var i=v.createElement("input");i.type="button",i.onclick=function(){return c(!0)},i.value="Cancel",style=i.style,style.margin="10px",style.display="inline",style.width="7em",/mac/.test(T.platform.toLowerCase())?(t.appendChild(i),t.appendChild(n)):(t.appendChild(n),t.appendChild(i)),b.addEvent(v.body,"keydown",s),r.style.top="50%",r.style.left="50%",r.style.display="block",x.isIE_5or6&&(r.style.position="absolute",r.style.top=v.documentElement.scrollTop+200+"px",r.style.left="50%"),v.body.appendChild(r),r.style.marginTop=-w.getHeight(r)/2+"px",r.style.marginLeft=-w.getWidth(r)/2+"px"}();var e=o.length;if(void 0!==l.selectionStart)l.selectionStart=0,l.selectionEnd=e;else if(l.createTextRange){var t=l.createTextRange();t.collapse(!1),t.moveStart("character",-e),t.moveEnd("character",e),t.select()}l.focus()},0)},w.getTop=function(e,t){var n=e.offsetTop;if(!t)for(;e=e.offsetParent;)n+=e.offsetTop;return n},w.getHeight=function(e){return e.offsetHeight||e.scrollHeight},w.getWidth=function(e){return e.offsetWidth||e.scrollWidth},w.getPageSize=function(){var e,t,n,i;return self.innerHeight&&self.scrollMaxY?(e=v.body.scrollWidth,t=self.innerHeight+self.scrollMaxY):v.body.scrollHeight>v.body.offsetHeight?(e=v.body.scrollWidth,t=v.body.scrollHeight):(e=v.body.offsetWidth,t=v.body.offsetHeight),self.innerHeight?(n=self.innerWidth,i=self.innerHeight):v.documentElement&&v.documentElement.clientHeight?(n=v.documentElement.clientWidth,i=v.documentElement.clientHeight):v.body&&(n=v.body.clientWidth,i=v.body.clientHeight),[Math.max(e,n),Math.max(t,i),n,i]},g.inputPoller=function(e,t){var n,i,a,o,r=this,l=g.panels.input;this.tick=function(){if(b.isVisible(l)){if(l.selectionStart||0===l.selectionStart){var e=l.selectionStart,t=l.selectionEnd;if((e!=n||t!=i)&&(n=e,i=t,a!=l.value))return a=l.value,!0}return!1}};var s=function(){b.isVisible(l)&&r.tick()&&e()};this.destroy=function(){top.clearInterval(o)},o=top.setInterval(s,t)},g.undoManager=function(t){var n,i,a,o,r=this,l=[],s=0,c="none",d=function(e,t){c!=e&&(c=e,t||p()),x.isIE&&"moving"==c?o=null:a=top.setTimeout(u,1)},u=function(){o=new g.TextareaState,i.tick(),a=void 0};this.setCommandMode=function(){c="command",p(),a=top.setTimeout(u,0)},this.canUndo=function(){return 1<s},this.canRedo=function(){return!!l[s+1]},this.undo=function(){r.canUndo()&&(n?(n.restore(),n=null):(l[s]=new g.TextareaState,l[--s].restore(),t&&t())),c="none",g.panels.input.focus(),u()},this.redo=function(){r.canRedo()&&(l[++s].restore(),t&&t()),c="none",g.panels.input.focus(),u()};var p=function(){var e=o||new g.TextareaState;if(!e)return!1;"moving"!=c?(n&&(l[s-1].text!=n.text&&(l[s++]=n),n=null),l[s++]=e,l[s+1]=null,t&&t()):n||(n=e)},f=function(e){var t=!1;if(e.ctrlKey||e.metaKey){var n=e.charCode||e.keyCode;switch(String.fromCharCode(n)){case"y":r.redo(),t=!0;break;case"z":e.shiftKey?r.redo():r.undo(),t=!0}}if(t)return e.preventDefault&&e.preventDefault(),void(top.event&&(top.event.returnValue=!1))},h=function(e){if(!e.ctrlKey&&!e.metaKey){var t=e.keyCode;33<=t&&t<=40||63232<=t&&t<=63235?d("moving"):8==t||46==t||127==t?d("deleting"):13==t?d("newlines"):27==t?d("escape"):(t<16||20<t)&&91!=t&&d("typing")}};this.destroy=function(){i&&i.destroy()},function(){b.addEvent(g.panels.input,"keypress",function(e){!e.ctrlKey&&!e.metaKey||89!=e.keyCode&&90!=e.keyCode||e.preventDefault()});var e=function(){(x.isIE||o&&o.text!=g.panels.input.value)&&null==a&&(c="paste",p(),u())};i=new g.inputPoller(e,100),b.addEvent(g.panels.input,"keydown",f),b.addEvent(g.panels.input,"keydown",h),b.addEvent(g.panels.input,"mousedown",function(){d("moving")}),g.panels.input.onpaste=e,g.panels.input.ondrop=e}(),u(),p()},g.editor=function(a){a||(a=function(){});var e,o,r=g.panels.input,l=this,n=function(e){if(r.focus(),e.textOp){o&&o.setCommandMode();var t=new g.TextareaState;if(!t)return;var n=t.getChunks(),i=function(){r.focus(),n&&t.setChunks(n),t.restore(),a()};e.textOp(n,i,!0)||i()}e.execute&&e.execute(l)},w=function(){o&&(y(document.getElementById("wmd-undo-button"),o.canUndo()),y(document.getElementById("wmd-redo-button"),o.canRedo()))},y=function(e,t){t?(e.style.backgroundPosition=e.XShift+" 0px",e.onmouseover=function(){this.style.backgroundPosition=this.XShift+" -40px"},e.onmouseout=function(){this.style.backgroundPosition=this.XShift+" 0px"},x.isIE&&(e.onmousedown=function(){g.ieRetardedClick=!0,g.ieCachedRange=document.selection.createRange()}),e.isHelp||(e.onclick=function(){return this.onmouseout&&this.onmouseout(),n(this),!1})):(e.style.backgroundPosition=e.XShift+" -20px",e.onmouseover=e.onmouseout=e.onclick=function(){})},t=function(){/\?noundo/.test(v.location.href)&&(g.nativeUndo=!0),g.nativeUndo||(o=new g.undoManager(function(){a(),w()})),function(){var e=document.getElementById("wmd-button-bar"),t=document.createElement("ul");t.id="wmd-button-row",t=e.appendChild(t);var n=document.createElement("li");n.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-bold"></use></svg>',n.className="wmd-button",n.id="wmd-bold-button",n.title="Strong <strong> Ctrl+B",n.XShift="0px",n.textOp=k.doBold,y(n,!0),t.appendChild(n);var i=document.createElement("li");i.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-italic"></use></svg>',i.className="wmd-button",i.id="wmd-italic-button",i.title="Emphasis <em> Ctrl+I",i.XShift="-20px",i.textOp=k.doItalic,y(i,!0),t.appendChild(i);var a=document.createElement("li");a.className="wmd-spacer",a.id="wmd-spacer1",t.appendChild(a);var o=document.createElement("li");o.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-link1"></use></svg>',o.className="wmd-button",o.id="wmd-link-button",o.title="Hyperlink <a> Ctrl+L",o.XShift="-40px",o.textOp=function(e,t,n){return k.doLinkOrImage(e,t,!1)},y(o,!0),t.appendChild(o);var r=document.createElement("li");r.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-Text-HighlightColor"></use></svg>',r.className="wmd-button",r.id="wmd-quote-button",r.title="Highlight <highlight> Ctrl+Q",r.XShift="-60px",r.textOp=k.doBlockquote,y(r,!0),t.appendChild(r);var l=document.createElement("li");l.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-code"></use></svg>',l.className="wmd-button",l.id="wmd-code-button",l.title="Code Sample <pre><code> Ctrl+K",l.XShift="-80px",l.textOp=k.doCode,y(l,!0),t.appendChild(l);var s=document.createElement("li");s.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-image"></use></svg>',s.className="wmd-button",s.id="wmd-image-button",s.title="Image <img> Ctrl+G",s.XShift="-100px",s.textOp=function(e,t,n){return k.doLinkOrImage(e,t,!0)},y(s,!0),t.appendChild(s);var c=document.createElement("li");c.className="wmd-spacer",c.id="wmd-spacer2",t.appendChild(c);var d=document.createElement("li");d.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-orderedlist"></use></svg>',d.className="wmd-button",d.id="wmd-olist-button",d.title="Numbered List <ol> Ctrl+O",d.XShift="-120px",d.textOp=function(e,t,n){k.doList(e,t,!0,n)},y(d,!0),t.appendChild(d);var u=document.createElement("li");u.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-unorderedlist"></use></svg>',u.className="wmd-button",u.id="wmd-ulist-button",u.title="Bulleted List <ul> Ctrl+U",u.XShift="-140px",u.textOp=function(e,t,n){k.doList(e,t,!1,n)},y(u,!0),t.appendChild(u);var p=document.createElement("li");p.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-section"></use></svg>',p.className="wmd-button",p.id="wmd-heading-button",p.title="Heading <h1>/<h2> Ctrl+H",p.XShift="-160px",p.textOp=k.doHeading,y(p,!0),t.appendChild(p);var f=document.createElement("li");f.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-dash"></use></svg>',f.className="wmd-button",f.id="wmd-hr-button",f.title="Horizontal Rule <hr> Ctrl+R",f.XShift="-180px",f.textOp=k.doHorizontalRule,y(f,!0),t.appendChild(f);var h=document.createElement("li");h.className="wmd-spacer",h.id="wmd-spacer3",t.appendChild(h);var m=document.createElement("li");m.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-undo1"></use></svg>',m.className="wmd-button",m.id="wmd-undo-button",m.title="Undo - Ctrl+Z",m.XShift="-200px",m.execute=function(e){e.undo()},y(m,!0),t.appendChild(m);var g=document.createElement("li");g.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-redo1"></use></svg>',g.className="wmd-button",g.id="wmd-redo-button",g.title="Redo - Ctrl+Y",/win/.test(T.platform.toLowerCase())?g.title="Redo - Ctrl+Y":g.title="Redo - Ctrl+Shift+Z",g.XShift="-220px",g.execute=function(e){e.redo()},y(g,!0),t.appendChild(g);var v=document.createElement("li");v.className="wmd-button",v.id="wmd-help-button",v.XShift="-240px",v.isHelp=!0;var b=document.createElement("a");b.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-question"></use></svg>',b.href="https://mathoverflow.net/editing-help",b.target="_blank",b.title="Editing Help",v.appendChild(b),y(v,!0),t.appendChild(v),w()}();var e="keydown";if(x.isOpera&&(e="keypress"),b.addEvent(r,e,function(e){if(e.ctrlKey||e.metaKey){var t=e.charCode||e.keyCode;switch(String.fromCharCode(t).toLowerCase()){case"b":n(document.getElementById("wmd-bold-button"));break;case"i":n(document.getElementById("wmd-italic-button"));break;case"l":n(document.getElementById("wmd-link-button"));break;case"q":n(document.getElementById("wmd-quote-button"));break;case"k":n(document.getElementById("wmd-code-button"));break;case"g":n(document.getElementById("wmd-image-button"));break;case"o":n(document.getElementById("wmd-olist-button"));break;case"u":n(document.getElementById("wmd-ulist-button"));break;case"h":n(document.getElementById("wmd-heading-button"));break;case"r":n(document.getElementById("wmd-hr-button"));break;case"y":n(document.getElementById("wmd-redo-button"));break;case"z":e.shiftKey?n(document.getElementById("wmd-redo-button")):n(document.getElementById("wmd-undo-button"));break;default:return}e.preventDefault&&e.preventDefault(),top.event&&(top.event.returnValue=!1)}}),b.addEvent(r,"keyup",function(e){e.shiftKey||e.ctrlKey||e.metaKey||13===(e.charCode||e.keyCode)&&(fakeButton={},fakeButton.textOp=k.doAutoindent,n(fakeButton))}),x.isIE&&b.addEvent(r,"keydown",function(e){if(27===e.keyCode)return!1}),r.form){var t=r.form.onsubmit;r.form.onsubmit=function(){if(i(),t)return t.apply(this,arguments)}}},i=function(){if(g.showdown)var e=new g.showdown.converter;var t=r.value;return/markdown/.test(g.wmd_env.output.toLowerCase())||e&&(r.value=e.makeHtml(t),top.setTimeout(function(){r.value=t},0)),!0};this.undo=function(){o&&o.undo()},this.redo=function(){o&&o.redo()};this.destroy=function(){o&&o.destroy(),e.parentNode&&e.parentNode.removeChild(e),r&&(r.style.marginTop=""),top.clearInterval(void 0)},t()},g.TextareaState=function(){var o=this,r=g.panels.input;this.init=function(){b.isVisible(r)&&(this.setInputAreaSelectionStartEnd(),this.scrollTop=r.scrollTop,(!this.text&&r.selectionStart||0===r.selectionStart)&&(this.text=r.value))},this.setInputAreaSelection=function(){if(b.isVisible(r))if(void 0===r.selectionStart||x.isOpera){if(v.selection){if(v.activeElement&&v.activeElement!==r)return;r.focus();var e=r.createTextRange();e.moveStart("character",-r.value.length),e.moveEnd("character",-r.value.length),e.moveEnd("character",o.end),e.moveStart("character",o.start),e.select()}}else r.focus(),r.selectionStart=o.start,r.selectionEnd=o.end,r.scrollTop=o.scrollTop},this.setInputAreaSelectionStartEnd=function(){if(r.selectionStart||0===r.selectionStart)o.start=r.selectionStart,o.end=r.selectionEnd;else if(v.selection){var e;o.text=b.fixEolChars(r.value),g.ieRetardedClick&&g.ieCachedRange?(e=g.ieCachedRange,g.ieRetardedClick=!1):e=v.selection.createRange();var t=b.fixEolChars(e.text),n=""+t+"";e.text=n;var i=b.fixEolChars(r.value);e.moveStart("character",-n.length),e.text=t,o.start=i.indexOf(""),o.end=i.lastIndexOf("")-"".length;var a=o.text.length-b.fixEolChars(r.value).length;if(a){for(e.moveStart("character",-t.length);a--;)t+="\n",o.end+=1;e.text=t}this.setInputAreaSelection()}},this.restore=function(){null!=o.text&&o.text!=r.value&&(r.value=o.text),this.setInputAreaSelection(),r.scrollTop=o.scrollTop},this.getChunks=function(){var e=new g.Chunks;return e.before=b.fixEolChars(o.text.substring(0,o.start)),e.startTag="",e.selection=b.fixEolChars(o.text.substring(o.start,o.end)),e.endTag="",e.after=b.fixEolChars(o.text.substring(o.end)),e.scrollTop=o.scrollTop,e},this.setChunks=function(e){e.before=e.before+e.startTag,e.after=e.endTag+e.after,x.isOpera&&(e.before=e.before.replace(/\n/g,"\r\n"),e.selection=e.selection.replace(/\n/g,"\r\n"),e.after=e.after.replace(/\n/g,"\r\n")),this.start=e.before.length,this.end=e.before.length+e.selection.length,this.text=e.before+e.selection+e.after,this.scrollTop=e.scrollTop},this.init()},g.Chunks=function(){},g.Chunks.prototype.findTags=function(e,t){var n,i=this;e&&(n=b.extendRegExp(e,"","$"),this.before=this.before.replace(n,function(e){return i.startTag=i.startTag+e,""}),n=b.extendRegExp(e,"^",""),this.selection=this.selection.replace(n,function(e){return i.startTag=i.startTag+e,""})),t&&(n=b.extendRegExp(t,"","$"),this.selection=this.selection.replace(n,function(e){return i.endTag=e+i.endTag,""}),n=b.extendRegExp(t,"^",""),this.after=this.after.replace(n,function(e){return i.endTag=e+i.endTag,""}))},g.Chunks.prototype.trimWhitespace=function(e){this.selection=this.selection.replace(/^(\s*)/,""),e||(this.before+=h.$1),this.selection=this.selection.replace(/(\s*)$/,""),e||(this.after=h.$1+this.after)},g.Chunks.prototype.addBlankLines=function(e,t,n){var i,a;if(void 0===e&&(e=1),void 0===t&&(t=1),e++,t++,this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+h.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+h.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+h.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+h.$1,this.before){for(i=a="";e--;)i+="\\n?",a+="\n";n&&(i="\\n*"),this.before=this.before.replace(new h(i+"$",""),a)}if(this.after){for(i=a="";t--;)i+="\\n?",a+="\n";n&&(i="\\n*"),this.after=this.after.replace(new h(i,""),a)}},k.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",k.unwrap=function(e){var t=new h("([^\\n])\\n(?!(\\n|"+k.prefixes+"))","g");e.selection=e.selection.replace(t,"$1 $2")},k.wrap=function(e,t){k.unwrap(e);var n=new h("(.{1,"+t+"})( +|$\\n?)","gm");e.selection=e.selection.replace(n,function(e,t){return new h("^"+k.prefixes,"").test(e)?e:t+"\n"}),e.selection=e.selection.replace(/\s+$/,"")},k.doBold=function(e,t,n){return k.doBorI(e,2,"strong text")},k.doItalic=function(e,t,n){return k.doBorI(e,1,"emphasized text")},k.doBorI=function(e,t,n){e.trimWhitespace(),e.selection=e.selection.replace(/\n{2,}/g,"\n"),e.before.search(/(\**$)/);var i=h.$1;e.after.search(/(^\**)/);var a=h.$1,o=Math.min(i.length,a.length);if(t<=o&&(2!=o||1!=t))e.before=e.before.replace(h("[*]{"+t+"}$",""),""),e.after=e.after.replace(h("^[*]{"+t+"}",""),"");else if(!e.selection&&a){e.after=e.after.replace(/^([*_]*)/,""),e.before=e.before.replace(/(\s?)$/,"");var r=h.$1;e.before=e.before+a+r}else{e.selection||a||(e.selection=n);var l=t<=1?"*":"**";e.before=e.before+l,e.after=l+e.after}},k.stripLinkDefs=function(e,o){return e=e.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(e,t,n,i,a){return o[t]=e.replace(/\s*$/,""),i?(o[t]=e.replace(/["(](.+?)[")]$/,""),i+a):""})},k.addLinkDef=function(e,t){var r=0,l={};e.before=k.stripLinkDefs(e.before,l),e.selection=k.stripLinkDefs(e.selection,l),e.after=k.stripLinkDefs(e.after,l);var n="",s=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,c=function(e){r++,e=e.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+r+"]:"),n+="\n"+e},d=function(e,t,n,i,a,o){return n=n.replace(s,d),l[a]?(c(l[a]),t+n+i+r+o):e};e.before=e.before.replace(s,d),t?c(t):e.selection=e.selection.replace(s,d);var i=r;return e.after=e.after.replace(s,d),e.after&&(e.after=e.after.replace(/\n*$/,"")),e.after||(e.selection=e.selection.replace(/\n*$/,"")),e.after+="\n\n"+n,i},k.doLinkOrImage=function(i,a,o){if(i.trimWhitespace(),i.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/),!(1<i.endTag.length)){if(/\n\n/.test(i.selection))return void k.addLinkDef(i,null);var e=function(e){if(null!==e){i.startTag=i.endTag="";var t=" [999]: "+e,n=k.addLinkDef(i,t);i.startTag=o?"![":"[",i.endTag="]["+n+"]",i.selection||(i.selection=o?"alt text":"link text")}a()};return o?b.prompt("<p style='margin-top: 0px'><b>Enter the image URL.</b></p><p>You can also add a title, which will be displayed as a tool tip.</p><p>Example:<br />http://wmd-editor.com/images/cloud1.jpg   \"Optional title\"</p>","http://",e):b.prompt("<p style='margin-top: 0px'><b>Enter the web address.</b></p><p>You can also add a title, which will be displayed as a tool tip.</p><p>Example:<br />http://wmd-editor.com/   \"Optional title\"</p>","http://",e),!0}i.startTag=i.startTag.replace(/!?\[/,""),i.endTag="",k.addLinkDef(i,null)},b.makeAPI=function(){g.wmd={},g.wmd.editor=g.editor,g.wmd.previewManager=g.previewManager},b.startEditor=function(){if(!1!==g.wmd_env.autostart){var t;b.addEvent(top,"load",function(){g.panels=new g.PanelCollection;var e=(t=new g.previewManager).refresh;new g.editor(e),t.refresh(!0)})}else b.makeAPI()},g.previewManager=function(){var i,e,t,a,o,r,n=this,l="delayed",s=function(){var e=0;return top.innerHeight?e=top.pageYOffset:v.documentElement&&v.documentElement.scrollTop?e=v.documentElement.scrollTop:v.body&&(e=v.body.scrollTop),e},c=function(){if(g.panels.preview||g.panels.output){var e=g.panels.input.value;if(!e||e!=o){o=e;var t=(new Date).getTime();!i&&g.showdown&&(i=new g.showdown.converter),i&&(e=i.makeHtml(e));var n=(new Date).getTime();a=n-t,m(e),r=e}}},d=function(){if(t&&(top.clearTimeout(t),t=void 0),"manual"!==l){var e=0;"delayed"===l&&(e=a),3e3<e&&(e=3e3),t=top.setTimeout(c,e)}},u=function(e){return e.scrollHeight<=e.clientHeight?1:e.scrollTop/(e.scrollHeight-e.clientHeight)};this.refresh=function(e){e?(o="",c()):d()},this.processingTime=function(){return a},this.output=function(){return r},this.setUpdateMode=function(e){l=e,n.refresh()};var p,f,h=!0,m=function(e){var t=w.getTop(g.panels.input)-s();if(g.panels.output)if(void 0!==g.panels.output.value)g.panels.output.value=e,g.panels.output.readOnly=!0;else{var n=e.replace(/&/g,"&amp;");n=n.replace(/</g,"&lt;"),g.panels.output.innerHTML="<pre><code>"+n+"</code></pre>"}if(g.panels.preview&&(g.panels.preview.innerHTML=e),g.panels.preview&&(g.panels.preview.scrollTop=(g.panels.preview.scrollHeight-g.panels.preview.clientHeight)*u(g.panels.preview)),g.panels.output&&(g.panels.output.scrollTop=(g.panels.output.scrollHeight-g.panels.output.clientHeight)*u(g.panels.output)),h)h=!1;else{var i=w.getTop(g.panels.input)-s();x.isIE?top.setTimeout(function(){top.scrollBy(0,i-t)},0):top.scrollBy(0,i-t)}};this.destroy=function(){e&&e.destroy()},p=g.panels.input,f=d,b.addEvent(p,"input",f),p.onpaste=f,p.ondrop=f,b.addEvent(p,"keypress",f),b.addEvent(p,"keydown",f),e=new g.inputPoller(f,500),c(),g.panels.preview&&(g.panels.preview.scrollTop=0),g.panels.output&&(g.panels.output.scrollTop=0)},k.doAutoindent=function(e,t,n){e.before=e.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ \t]+\n$/,"\n\n"),/(\n|^)[ ]{0,3}([*+-])[ \t]+.*\n$/.test(e.before)&&k.doList&&k.doList(e,t,!1,!0),/(\n|^)[ ]{0,3}(\d+[.])[ \t]+.*\n$/.test(e.before)&&k.doList&&k.doList(e,t,!0,!0),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(e.before)&&k.doBlockquote&&k.doBlockquote(e,t,!1),/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)&&k.doCode&&k.doCode(e,t,!1)},k.doBlockquote=function(a,e,t){a.selection=a.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(e,t,n,i){return a.before+=t,a.after=i+a.after,n}),a.before=a.before.replace(/(>[ \t]*)$/,function(e,t){return a.selection=t+a.selection,""});var n=t?"Highlight":"";a.selection=a.selection.replace(/^(\s|>)+$/,""),a.selection=a.selection||n;var i="",o="";if(a.before){var r=a.before.replace(/\n$/,"").split("\n"),l=!1;for(var s in r){var c=!1;line=r[s],l=l&&0<line.length,/^>/.test(line)?(c=!0,!l&&1<line.length&&(l=!0)):c=!!/^[ \t]*$/.test(line)||l,c?i+=line+"\n":(o+=i+line,i="\n")}/(^|\n)>/.test(i)||(o+=i,i="")}a.startTag=i,a.before=o,a.after&&(a.after=a.after.replace(/^\n?/,"\n")),a.after=a.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(e){return a.endTag=e,""});var d=function(e){var n=e?"> ":"";a.startTag&&(a.startTag=a.startTag.replace(/\n((>|\s)*)\n$/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"})),a.endTag&&(a.endTag=a.endTag.replace(/^\n((>|\s)*)\n/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"}))};/^(?![ ]{0,3}>)/m.test(a.selection)?(k.wrap(a,g.wmd_env.lineLength-2),a.selection=a.selection.replace(/^/gm,"> "),d(!0),a.addBlankLines()):(a.selection=a.selection.replace(/^[ ]{0,3}> ?/gm,""),k.unwrap(a),d(!1),!/^(\n|^)[ ]{0,3}>/.test(a.selection)&&a.startTag&&(a.startTag=a.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(a.selection)&&a.endTag&&(a.endTag=a.endTag.replace(/^\n{0,2}/,"\n\n"))),/\n/.test(a.selection)||(a.selection=a.selection.replace(/^(> *)/,function(e,t){return a.startTag+=t,""}))},k.doCode=function(t,e,n){var i=/\S[ ]*$/.test(t.before);if(!/^[ ]*\S/.test(t.after)&&!i||/\n/.test(t.selection)){t.before=t.before.replace(/[ ]{4}$/,function(e){return t.selection=e+t.selection,""});var a=1,o=1;(/\n(\t|[ ]{4,}).*\n$/.test(t.before)||""===t.after)&&(a=0),/^\n(\t|[ ]{4,})/.test(t.after)&&(o=0),t.addBlankLines(a,o),t.selection?/^[ ]{0,3}\S/m.test(t.selection)?t.selection=t.selection.replace(/^/gm,"    "):t.selection=t.selection.replace(/^[ ]{4}/gm,""):(t.startTag="    ",t.selection=n?"enter code here":"")}else t.trimWhitespace(),t.findTags(/`/,/`/),t.startTag||t.endTag?t.endTag&&!t.startTag?(t.before+=t.endTag,t.endTag=""):t.startTag=t.endTag="":(t.startTag=t.endTag="`",t.selection||(t.selection=n?"enter code here":""))},k.doList=function(e,t,n,i){var a=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,o="-",r=1,l=function(){var e;return n?(e=" "+r+". ",r++):e=" "+o+" ",e},s=function(e){return void 0===n&&(n=/^\s*\d/.test(e)),e=e.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(e){return l()})};if(e.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!e.before||/\n$/.test(e.before)||/^\n/.test(e.startTag)||(e.before+=e.startTag,e.startTag=""),e.startTag){var c=/\d+[.]/.test(e.startTag);if(e.startTag="",e.selection=e.selection.replace(/\n[ ]{4}/g,"\n"),k.unwrap(e),e.addBlankLines(),c&&(e.after=e.after.replace(a,s)),n==c)return}var d=1;e.before=e.before.replace(/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,function(e){return/^\s*([*+-])/.test(e)&&(o=h.$1),d=/[^\n]\n\n[^\n]/.test(e)?1:0,s(e)}),e.selection||(e.selection=i?"List item":" ");var u=l(),p=1;e.after=e.after.replace(a,function(e){return p=/[^\n]\n\n[^\n]/.test(e)?1:0,s(e)}),e.trimWhitespace(!0),e.addBlankLines(d,p,!0);var f=(e.startTag=u).replace(/./g," ");k.wrap(e,g.wmd_env.lineLength-f.length),e.selection=e.selection.replace(/\n/g,"\n"+f)},k.doHeading=function(e,t,n){if(e.selection=e.selection.replace(/\s+/g," "),e.selection=e.selection.replace(/(^\s+|\s+$)/g,""),!e.selection)return e.startTag="## ",e.selection="Heading",void(e.endTag=" ##");var i=0;e.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(e.startTag)&&(i=h.lastMatch.length),e.startTag=e.endTag="",e.findTags(null,/\s?(-+|=+)/),/=+/.test(e.endTag)&&(i=1),/-+/.test(e.endTag)&&(i=2),e.startTag=e.endTag="",e.addBlankLines(1,1);var a=0==i?2:i-1;if(0<a){var o=2<=a?"-":"=",r=e.selection.length;for(r>g.wmd_env.lineLength&&(r=g.wmd_env.lineLength),e.endTag="\n";r--;)e.endTag+=o}},k.doHorizontalRule=function(e,t,n){e.startTag="----------\n",e.selection="",e.addBlankLines(2,1,!0)}},Attacklab.wmd_env={},Attacklab.account_options={},Attacklab.wmd_defaults={version:1,output:"HTML",lineLength:40,delayLoad:!1},Attacklab.wmd||(Attacklab.wmd=function(){Attacklab.loadEnv=function(){var e=function(e){if(e)for(var t in e)Attacklab.wmd_env[t]=e[t]};e(Attacklab.wmd_defaults),e(Attacklab.account_options),e(top.wmd_options),Attacklab.full=!0;Attacklab.wmd_env.buttons=Attacklab.wmd_env.buttons||"bold italic link blockquote code image ol ul heading hr"},Attacklab.loadEnv()},Attacklab.wmd(),Attacklab.wmdBase(),Attacklab.Util.startEditor());