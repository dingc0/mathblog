var Attacklab=Attacklab||{};Attacklab.wmdBase=function(){var e=top.Attacklab,t=top.document,n=top.RegExp,i=top.navigator;e.Util={},e.Position={},e.Command={},e.Global={};var o=e.Util,a=e.Position,r=e.Command,l=e.Global;l.isIE=/msie/.test(i.userAgent.toLowerCase()),l.isIE_5or6=/msie 6/.test(i.userAgent.toLowerCase())||/msie 5/.test(i.userAgent.toLowerCase()),l.isIE_7plus=l.isIE&&!l.isIE_5or6,l.isOpera=/opera/.test(i.userAgent.toLowerCase()),l.isKonqueror=/konqueror/.test(i.userAgent.toLowerCase());e.PanelCollection=function(){this.buttonBar=t.getElementById("wmd-button-bar"),this.preview=t.getElementById("wmd-preview"),this.output=t.getElementById("wmd-output"),this.input=t.getElementById("content")},e.panels=void 0,e.ieCachedRange=null,e.ieRetardedClick=!1,o.isVisible=function(e){return window.getComputedStyle?"none"!==window.getComputedStyle(e,null).getPropertyValue("display"):e.currentStyle?"none"!==e.currentStyle.display:void 0},o.addEvent=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},o.removeEvent=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},o.fixEolChars=function(e){return e=(e=e.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")},o.extendRegExp=function(e,t,n){null!==t&&void 0!==t||(t=""),null!==n&&void 0!==n||(n="");var i=e.toString(),o="",a=i.match(/\/([gim]*)$/);return o=null===a?a[0]:"",i=t+(i=i.replace(/(^\/|\/[gim]*$)/g,""))+n,new RegExp(i,o)},o.createImage=function(e){var n="images/"+e,i=t.createElement("img");return i.className="wmd-button",i.src=n,i},o.prompt=function(e,n,r){var s,c,d;void 0===n&&(n="");var u=function(e){27===(e.charCode||e.keyCode)&&p(!0)},p=function(e){o.removeEvent(t.body,"keydown",u);var n=d.value;return e?n=null:-1===(n=(n=(n=n.replace("http://http://","http://")).replace("http://https://","https://")).replace("http://ftp://","ftp://")).indexOf("http://")&&-1===n.indexOf("ftp://")&&-1===n.indexOf("https://")&&(n="http://"+n),s.parentNode.removeChild(s),c.parentNode.removeChild(c),r(n),!1};!function(){(c=t.createElement("div")).className="wmd-prompt-background",style=c.style,style.position="absolute",style.top="0",style.zIndex="1000",l.isKonqueror?style.backgroundColor="transparent":l.isIE?style.filter="alpha(opacity=50)":style.opacity="0.5";var e=a.getPageSize();style.height=e[1]+"px",l.isIE?(style.left=t.documentElement.scrollLeft,style.width=t.documentElement.clientWidth):(style.left="0",style.width="100%"),t.body.appendChild(c)}(),top.setTimeout(function(){!function(){(s=t.createElement("div")).className="wmd-prompt-dialog",s.style.padding="10px;",s.style.position="fixed",s.style.width="400px",s.style.zIndex="1001";var r=t.createElement("div");r.innerHTML=e,r.style.padding="5px",s.appendChild(r);var c=t.createElement("form");c.onsubmit=function(){return p(!1)},style=c.style,style.padding="0",style.margin="0",style.cssFloat="left",style.width="100%",style.textAlign="center",style.position="relative",s.appendChild(c),(d=t.createElement("input")).type="text",d.value=n,style=d.style,style.display="block",style.width="80%",style.marginLeft=style.marginRight="auto",c.appendChild(d);var f=t.createElement("input");f.type="button",f.onclick=function(){return p(!1)},f.value="OK",style=f.style,style.margin="10px",style.display="inline",style.width="7em";var h=t.createElement("input");h.type="button",h.onclick=function(){return p(!0)},h.value="Cancel",style=h.style,style.margin="10px",style.display="inline",style.width="7em",/mac/.test(i.platform.toLowerCase())?(c.appendChild(h),c.appendChild(f)):(c.appendChild(f),c.appendChild(h)),o.addEvent(t.body,"keydown",u),s.style.top="50%",s.style.left="50%",s.style.display="block",l.isIE_5or6&&(s.style.position="absolute",s.style.top=t.documentElement.scrollTop+200+"px",s.style.left="50%"),t.body.appendChild(s),s.style.marginTop=-a.getHeight(s)/2+"px",s.style.marginLeft=-a.getWidth(s)/2+"px"}();var r=n.length;if(void 0!==d.selectionStart)d.selectionStart=0,d.selectionEnd=r;else if(d.createTextRange){var c=d.createTextRange();c.collapse(!1),c.moveStart("character",-r),c.moveEnd("character",r),c.select()}d.focus()},0)},a.getTop=function(e,t){var n=e.offsetTop;if(!t)for(;e=e.offsetParent;)n+=e.offsetTop;return n},a.getHeight=function(e){return e.offsetHeight||e.scrollHeight},a.getWidth=function(e){return e.offsetWidth||e.scrollWidth},a.getPageSize=function(){var e,n,i,o;return self.innerHeight&&self.scrollMaxY?(e=t.body.scrollWidth,n=self.innerHeight+self.scrollMaxY):t.body.scrollHeight>t.body.offsetHeight?(e=t.body.scrollWidth,n=t.body.scrollHeight):(e=t.body.offsetWidth,n=t.body.offsetHeight),self.innerHeight?(i=self.innerWidth,o=self.innerHeight):t.documentElement&&t.documentElement.clientHeight?(i=t.documentElement.clientWidth,o=t.documentElement.clientHeight):t.body&&(i=t.body.clientWidth,o=t.body.clientHeight),[Math.max(e,i),Math.max(n,o),i,o]},e.inputPoller=function(t,n){var i,a,r,l,s=this,c=e.panels.input;this.tick=function(){if(o.isVisible(c)){if(c.selectionStart||0===c.selectionStart){var e=c.selectionStart,t=c.selectionEnd;if((e!=i||t!=a)&&(i=e,a=t,r!=c.value))return r=c.value,!0}return!1}};var d=function(){o.isVisible(c)&&s.tick()&&t()};this.destroy=function(){top.clearInterval(l)},l=top.setInterval(d,n)},e.undoManager=function(t){var n,i,a,r,s=this,c=[],d=0,u="none",p=function(e,t){u!=e&&(u=e,t||h()),l.isIE&&"moving"==u?r=null:a=top.setTimeout(f,1)},f=function(){r=new e.TextareaState,i.tick(),a=void 0};this.setCommandMode=function(){u="command",h(),a=top.setTimeout(f,0)},this.canUndo=function(){return d>1},this.canRedo=function(){return!!c[d+1]},this.undo=function(){s.canUndo()&&(n?(n.restore(),n=null):(c[d]=new e.TextareaState,c[--d].restore(),t&&t())),u="none",e.panels.input.focus(),f()},this.redo=function(){s.canRedo()&&(c[++d].restore(),t&&t()),u="none",e.panels.input.focus(),f()};var h=function(){var i=r||new e.TextareaState;if(!i)return!1;"moving"!=u?(n&&(c[d-1].text!=n.text&&(c[d++]=n),n=null),c[d++]=i,c[d+1]=null,t&&t()):n||(n=i)},m=function(e){var t=!1;if(e.ctrlKey||e.metaKey){var n=e.charCode||e.keyCode;switch(String.fromCharCode(n)){case"y":s.redo(),t=!0;break;case"z":e.shiftKey?s.redo():s.undo(),t=!0}}if(t)return e.preventDefault&&e.preventDefault(),void(top.event&&(top.event.returnValue=!1))},g=function(e){if(!e.ctrlKey&&!e.metaKey){var t=e.keyCode;t>=33&&t<=40||t>=63232&&t<=63235?p("moving"):8==t||46==t||127==t?p("deleting"):13==t?p("newlines"):27==t?p("escape"):(t<16||t>20)&&91!=t&&p("typing")}};this.destroy=function(){i&&i.destroy()},function(){o.addEvent(e.panels.input,"keypress",function(e){!e.ctrlKey&&!e.metaKey||89!=e.keyCode&&90!=e.keyCode||e.preventDefault()});var t=function(){(l.isIE||r&&r.text!=e.panels.input.value)&&void 0==a&&(u="paste",h(),f())};i=new e.inputPoller(t,100),o.addEvent(e.panels.input,"keydown",m),o.addEvent(e.panels.input,"keydown",g),o.addEvent(e.panels.input,"mousedown",function(){p("moving")}),e.panels.input.onpaste=t,e.panels.input.ondrop=t}(),f(),h()},e.editor=function(n){n||(n=function(){});var a,s,c=e.panels.input,d=this,u=function(t){if(c.focus(),t.textOp){s&&s.setCommandMode();var i=new e.TextareaState;if(!i)return;var o=i.getChunks(),a=function(){c.focus(),o&&i.setChunks(o),i.restore(),n()};t.textOp(o,a,!0)||a()}t.execute&&t.execute(d)},p=function(){s&&(f(document.getElementById("wmd-undo-button"),s.canUndo()),f(document.getElementById("wmd-redo-button"),s.canRedo()))},f=function(t,n){n?(t.style.backgroundPosition=t.XShift+" 0px",t.onmouseover=function(){this.style.backgroundPosition=this.XShift+" -40px"},t.onmouseout=function(){this.style.backgroundPosition=this.XShift+" 0px"},l.isIE&&(t.onmousedown=function(){e.ieRetardedClick=!0,e.ieCachedRange=document.selection.createRange()}),t.isHelp||(t.onclick=function(){return this.onmouseout&&this.onmouseout(),u(this),!1})):(t.style.backgroundPosition=t.XShift+" -20px",t.onmouseover=t.onmouseout=t.onclick=function(){})},h=function(){/\?noundo/.test(t.location.href)&&(e.nativeUndo=!0),e.nativeUndo||(s=new e.undoManager(function(){n(),p()})),function(){var e=document.getElementById("wmd-button-bar"),t=document.createElement("ul");t.id="wmd-button-row",t=e.appendChild(t);var n=document.createElement("li");n.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-bold"></use></svg>',n.className="wmd-button",n.id="wmd-bold-button",n.title="Strong <strong> Ctrl+B",n.XShift="0px",n.textOp=r.doBold,f(n,!0),t.appendChild(n);var o=document.createElement("li");o.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-italic"></use></svg>',o.className="wmd-button",o.id="wmd-italic-button",o.title="Emphasis <em> Ctrl+I",o.XShift="-20px",o.textOp=r.doItalic,f(o,!0),t.appendChild(o);var a=document.createElement("li");a.className="wmd-spacer",a.id="wmd-spacer1",t.appendChild(a);var l=document.createElement("li");l.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-link1"></use></svg>',l.className="wmd-button",l.id="wmd-link-button",l.title="Hyperlink <a> Ctrl+L",l.XShift="-40px",l.textOp=function(e,t,n){return r.doLinkOrImage(e,t,!1)},f(l,!0),t.appendChild(l);var s=document.createElement("li");s.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-Text-HighlightColor"></use></svg>',s.className="wmd-button",s.id="wmd-quote-button",s.title="Highlight <highlight> Ctrl+Q",s.XShift="-60px",s.textOp=r.doBlockquote,f(s,!0),t.appendChild(s);var c=document.createElement("li");c.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-code"></use></svg>',c.className="wmd-button",c.id="wmd-code-button",c.title="Code Sample <pre><code> Ctrl+K",c.XShift="-80px",c.textOp=r.doCode,f(c,!0),t.appendChild(c);var d=document.createElement("li");d.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-image"></use></svg>',d.className="wmd-button",d.id="wmd-image-button",d.title="Image <img> Ctrl+G",d.XShift="-100px",d.textOp=function(e,t,n){return r.doLinkOrImage(e,t,!0)},f(d,!0),t.appendChild(d);var u=document.createElement("li");u.className="wmd-spacer",u.id="wmd-spacer2",t.appendChild(u);var h=document.createElement("li");h.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-orderedlist"></use></svg>',h.className="wmd-button",h.id="wmd-olist-button",h.title="Numbered List <ol> Ctrl+O",h.XShift="-120px",h.textOp=function(e,t,n){r.doList(e,t,!0,n)},f(h,!0),t.appendChild(h);var m=document.createElement("li");m.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-unorderedlist"></use></svg>',m.className="wmd-button",m.id="wmd-ulist-button",m.title="Bulleted List <ul> Ctrl+U",m.XShift="-140px",m.textOp=function(e,t,n){r.doList(e,t,!1,n)},f(m,!0),t.appendChild(m);var g=document.createElement("li");g.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-section"></use></svg>',g.className="wmd-button",g.id="wmd-heading-button",g.title="Heading <h1>/<h2> Ctrl+H",g.XShift="-160px",g.textOp=r.doHeading,f(g,!0),t.appendChild(g);var v=document.createElement("li");v.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-dash"></use></svg>',v.className="wmd-button",v.id="wmd-hr-button",v.title="Horizontal Rule <hr> Ctrl+R",v.XShift="-180px",v.textOp=r.doHorizontalRule,f(v,!0),t.appendChild(v);var b=document.createElement("li");b.className="wmd-spacer",b.id="wmd-spacer3",t.appendChild(b);var w=document.createElement("li");w.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-undo1"></use></svg>',w.className="wmd-button",w.id="wmd-undo-button",w.title="Undo - Ctrl+Z",w.XShift="-200px",w.execute=function(e){e.undo()},f(w,!0),t.appendChild(w);var y=document.createElement("li");y.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-redo1"></use></svg>',y.className="wmd-button",y.id="wmd-redo-button",y.title="Redo - Ctrl+Y",/win/.test(i.platform.toLowerCase())?y.title="Redo - Ctrl+Y":y.title="Redo - Ctrl+Shift+Z",y.XShift="-220px",y.execute=function(e){e.redo()},f(y,!0),t.appendChild(y);var T=document.createElement("li");T.className="wmd-button",T.id="wmd-help-button",T.XShift="-240px",T.isHelp=!0;var k=document.createElement("a");k.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-question"></use></svg>',k.href="https://mathoverflow.net/editing-help",k.target="_blank",k.title="Editing Help",T.appendChild(k),f(T,!0),t.appendChild(T),p()}();var a="keydown";if(l.isOpera&&(a="keypress"),o.addEvent(c,a,function(e){if(e.ctrlKey||e.metaKey){var t=e.charCode||e.keyCode;switch(String.fromCharCode(t).toLowerCase()){case"b":u(document.getElementById("wmd-bold-button"));break;case"i":u(document.getElementById("wmd-italic-button"));break;case"l":u(document.getElementById("wmd-link-button"));break;case"q":u(document.getElementById("wmd-quote-button"));break;case"k":u(document.getElementById("wmd-code-button"));break;case"g":u(document.getElementById("wmd-image-button"));break;case"o":u(document.getElementById("wmd-olist-button"));break;case"u":u(document.getElementById("wmd-ulist-button"));break;case"h":u(document.getElementById("wmd-heading-button"));break;case"r":u(document.getElementById("wmd-hr-button"));break;case"y":u(document.getElementById("wmd-redo-button"));break;case"z":e.shiftKey?u(document.getElementById("wmd-redo-button")):u(document.getElementById("wmd-undo-button"));break;default:return}e.preventDefault&&e.preventDefault(),top.event&&(top.event.returnValue=!1)}}),o.addEvent(c,"keyup",function(e){e.shiftKey||e.ctrlKey||e.metaKey||13===(e.charCode||e.keyCode)&&(fakeButton={},fakeButton.textOp=r.doAutoindent,u(fakeButton))}),l.isIE&&o.addEvent(c,"keydown",function(e){if(27===e.keyCode)return!1}),c.form){var d=c.form.onsubmit;c.form.onsubmit=function(){if(m(),d)return d.apply(this,arguments)}}},m=function(){if(e.showdown)var t=new e.showdown.converter;var n=c.value;return/markdown/.test(e.wmd_env.output.toLowerCase())||t&&(c.value=t.makeHtml(n),top.setTimeout(function(){c.value=n},0)),!0};this.undo=function(){s&&s.undo()},this.redo=function(){s&&s.redo()};this.destroy=function(){s&&s.destroy(),a.parentNode&&a.parentNode.removeChild(a),c&&(c.style.marginTop=""),top.clearInterval(void 0)},h()},e.TextareaState=function(){var n=this,i=e.panels.input;this.init=function(){o.isVisible(i)&&(this.setInputAreaSelectionStartEnd(),this.scrollTop=i.scrollTop,(!this.text&&i.selectionStart||0===i.selectionStart)&&(this.text=i.value))},this.setInputAreaSelection=function(){if(o.isVisible(i))if(void 0===i.selectionStart||l.isOpera){if(t.selection){if(t.activeElement&&t.activeElement!==i)return;i.focus();var e=i.createTextRange();e.moveStart("character",-i.value.length),e.moveEnd("character",-i.value.length),e.moveEnd("character",n.end),e.moveStart("character",n.start),e.select()}}else i.focus(),i.selectionStart=n.start,i.selectionEnd=n.end,i.scrollTop=n.scrollTop},this.setInputAreaSelectionStartEnd=function(){if(i.selectionStart||0===i.selectionStart)n.start=i.selectionStart,n.end=i.selectionEnd;else if(t.selection){var a;n.text=o.fixEolChars(i.value),e.ieRetardedClick&&e.ieCachedRange?(a=e.ieCachedRange,e.ieRetardedClick=!1):a=t.selection.createRange();var r=o.fixEolChars(a.text),l=""+r+"";a.text=l;var s=o.fixEolChars(i.value);a.moveStart("character",-l.length),a.text=r,n.start=s.indexOf(""),n.end=s.lastIndexOf("")-"".length;var c=n.text.length-o.fixEolChars(i.value).length;if(c){for(a.moveStart("character",-r.length);c--;)r+="\n",n.end+=1;a.text=r}this.setInputAreaSelection()}},this.restore=function(){void 0!=n.text&&n.text!=i.value&&(i.value=n.text),this.setInputAreaSelection(),i.scrollTop=n.scrollTop},this.getChunks=function(){var t=new e.Chunks;return t.before=o.fixEolChars(n.text.substring(0,n.start)),t.startTag="",t.selection=o.fixEolChars(n.text.substring(n.start,n.end)),t.endTag="",t.after=o.fixEolChars(n.text.substring(n.end)),t.scrollTop=n.scrollTop,t},this.setChunks=function(e){e.before=e.before+e.startTag,e.after=e.endTag+e.after,l.isOpera&&(e.before=e.before.replace(/\n/g,"\r\n"),e.selection=e.selection.replace(/\n/g,"\r\n"),e.after=e.after.replace(/\n/g,"\r\n")),this.start=e.before.length,this.end=e.before.length+e.selection.length,this.text=e.before+e.selection+e.after,this.scrollTop=e.scrollTop},this.init()},e.Chunks=function(){},e.Chunks.prototype.findTags=function(e,t){var n,i=this;e&&(n=o.extendRegExp(e,"","$"),this.before=this.before.replace(n,function(e){return i.startTag=i.startTag+e,""}),n=o.extendRegExp(e,"^",""),this.selection=this.selection.replace(n,function(e){return i.startTag=i.startTag+e,""})),t&&(n=o.extendRegExp(t,"","$"),this.selection=this.selection.replace(n,function(e){return i.endTag=e+i.endTag,""}),n=o.extendRegExp(t,"^",""),this.after=this.after.replace(n,function(e){return i.endTag=e+i.endTag,""}))},e.Chunks.prototype.trimWhitespace=function(e){this.selection=this.selection.replace(/^(\s*)/,""),e||(this.before+=n.$1),this.selection=this.selection.replace(/(\s*)$/,""),e||(this.after=n.$1+this.after)},e.Chunks.prototype.addBlankLines=function(e,t,i){var o,a;if(void 0===e&&(e=1),void 0===t&&(t=1),e++,t++,this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+n.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+n.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+n.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+n.$1,this.before){for(o=a="";e--;)o+="\\n?",a+="\n";i&&(o="\\n*"),this.before=this.before.replace(new n(o+"$",""),a)}if(this.after){for(o=a="";t--;)o+="\\n?",a+="\n";i&&(o="\\n*"),this.after=this.after.replace(new n(o,""),a)}},r.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",r.unwrap=function(e){var t=new n("([^\\n])\\n(?!(\\n|"+r.prefixes+"))","g");e.selection=e.selection.replace(t,"$1 $2")},r.wrap=function(e,t){r.unwrap(e);var i=new n("(.{1,"+t+"})( +|$\\n?)","gm");e.selection=e.selection.replace(i,function(e,t){return new n("^"+r.prefixes,"").test(e)?e:t+"\n"}),e.selection=e.selection.replace(/\s+$/,"")},r.doBold=function(e,t,n){return r.doBorI(e,2,"strong text")},r.doItalic=function(e,t,n){return r.doBorI(e,1,"emphasized text")},r.doBorI=function(e,t,i){e.trimWhitespace(),e.selection=e.selection.replace(/\n{2,}/g,"\n"),e.before.search(/(\**$)/);var o=n.$1;e.after.search(/(^\**)/);var a=n.$1,r=Math.min(o.length,a.length);if(r>=t&&(2!=r||1!=t))e.before=e.before.replace(n("[*]{"+t+"}$",""),""),e.after=e.after.replace(n("^[*]{"+t+"}",""),"");else if(!e.selection&&a){e.after=e.after.replace(/^([*_]*)/,""),e.before=e.before.replace(/(\s?)$/,"");var l=n.$1;e.before=e.before+a+l}else{e.selection||a||(e.selection=i);var s=t<=1?"*":"**";e.before=e.before+s,e.after=s+e.after}},r.stripLinkDefs=function(e,t){return e=e.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(e,n,i,o,a){return t[n]=e.replace(/\s*$/,""),o?(t[n]=e.replace(/["(](.+?)[")]$/,""),o+a):""})},r.addLinkDef=function(e,t){var n=0,i={};e.before=r.stripLinkDefs(e.before,i),e.selection=r.stripLinkDefs(e.selection,i),e.after=r.stripLinkDefs(e.after,i);var o="",a=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,l=function(e){n++,e=e.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+n+"]:"),o+="\n"+e},s=function(e,t,o,r,c,d){return o=o.replace(a,s),i[c]?(l(i[c]),t+o+r+n+d):e};e.before=e.before.replace(a,s),t?l(t):e.selection=e.selection.replace(a,s);var c=n;return e.after=e.after.replace(a,s),e.after&&(e.after=e.after.replace(/\n*$/,"")),e.after||(e.selection=e.selection.replace(/\n*$/,"")),e.after+="\n\n"+o,c},r.doLinkOrImage=function(e,t,n){if(e.trimWhitespace(),e.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/),!(e.endTag.length>1)){if(/\n\n/.test(e.selection))return void r.addLinkDef(e,null);var i=function(i){if(null!==i){e.startTag=e.endTag="";var o=" [999]: "+i,a=r.addLinkDef(e,o);e.startTag=n?"![":"[",e.endTag="]["+a+"]",e.selection||(e.selection=n?"alt text":"link text")}t()};return n?o.prompt("<p style='margin-top: 0px'><b>Enter the image URL.</b></p><p>You can also add a title, which will be displayed as a tool tip.</p><p>Example:<br />http://wmd-editor.com/images/cloud1.jpg   \"Optional title\"</p>","http://",i):o.prompt("<p style='margin-top: 0px'><b>Enter the web address.</b></p><p>You can also add a title, which will be displayed as a tool tip.</p><p>Example:<br />http://wmd-editor.com/   \"Optional title\"</p>","http://",i),!0}e.startTag=e.startTag.replace(/!?\[/,""),e.endTag="",r.addLinkDef(e,null)},o.makeAPI=function(){e.wmd={},e.wmd.editor=e.editor,e.wmd.previewManager=e.previewManager},o.startEditor=function(){if(!1!==e.wmd_env.autostart){var t;o.addEvent(top,"load",function(){e.panels=new e.PanelCollection;var n=(t=new e.previewManager).refresh;new e.editor(n),t.refresh(!0)})}else o.makeAPI()},e.previewManager=function(){var n,i,r,s,c,d,u=this,p="delayed",f=function(){var e=0;return top.innerHeight?e=top.pageYOffset:t.documentElement&&t.documentElement.scrollTop?e=t.documentElement.scrollTop:t.body&&(e=t.body.scrollTop),e},h=function(){if(e.panels.preview||e.panels.output){var t=e.panels.input.value;if(!t||t!=c){c=t;var i=(new Date).getTime();!n&&e.showdown&&(n=new e.showdown.converter),n&&(t=n.makeHtml(t));var o=(new Date).getTime();s=o-i,y(t),d=t}}},m=function(){if(r&&(top.clearTimeout(r),r=void 0),"manual"!==p){var e=0;"delayed"===p&&(e=s),e>3e3&&(e=3e3),r=top.setTimeout(h,e)}},g=function(e){return e.scrollHeight<=e.clientHeight?1:e.scrollTop/(e.scrollHeight-e.clientHeight)};this.refresh=function(e){e?(c="",h()):m()},this.processingTime=function(){return s},this.output=function(){return d},this.setUpdateMode=function(e){p=e,u.refresh()};var v,b,w=!0,y=function(t){var n=a.getTop(e.panels.input)-f();if(e.panels.output)if(void 0!==e.panels.output.value)e.panels.output.value=t,e.panels.output.readOnly=!0;else{var i=t.replace(/&/g,"&amp;");i=i.replace(/</g,"&lt;"),e.panels.output.innerHTML="<pre><code>"+i+"</code></pre>"}if(e.panels.preview&&(e.panels.preview.innerHTML=t),e.panels.preview&&(e.panels.preview.scrollTop=(e.panels.preview.scrollHeight-e.panels.preview.clientHeight)*g(e.panels.preview)),e.panels.output&&(e.panels.output.scrollTop=(e.panels.output.scrollHeight-e.panels.output.clientHeight)*g(e.panels.output)),w)w=!1;else{var o=a.getTop(e.panels.input)-f();l.isIE?top.setTimeout(function(){top.scrollBy(0,o-n)},0):top.scrollBy(0,o-n)}};this.destroy=function(){i&&i.destroy()},v=e.panels.input,b=m,o.addEvent(v,"input",b),v.onpaste=b,v.ondrop=b,o.addEvent(v,"keypress",b),o.addEvent(v,"keydown",b),i=new e.inputPoller(b,500),h(),e.panels.preview&&(e.panels.preview.scrollTop=0),e.panels.output&&(e.panels.output.scrollTop=0)},r.doAutoindent=function(e,t,n){e.before=e.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ \t]+\n$/,"\n\n"),/(\n|^)[ ]{0,3}([*+-])[ \t]+.*\n$/.test(e.before)&&r.doList&&r.doList(e,t,!1,!0),/(\n|^)[ ]{0,3}(\d+[.])[ \t]+.*\n$/.test(e.before)&&r.doList&&r.doList(e,t,!0,!0),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(e.before)&&r.doBlockquote&&r.doBlockquote(e,t,!1),/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)&&r.doCode&&r.doCode(e,t,!1)},r.doBlockquote=function(t,n,i){t.selection=t.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(e,n,i,o){return t.before+=n,t.after=o+t.after,i}),t.before=t.before.replace(/(>[ \t]*)$/,function(e,n){return t.selection=n+t.selection,""});var o=i?"Highlight":"";t.selection=t.selection.replace(/^(\s|>)+$/,""),t.selection=t.selection||o;var a="",l="";if(t.before){var s=t.before.replace(/\n$/,"").split("\n"),c=!1;for(var d in s){var u=!1;line=s[d],c=c&&line.length>0,/^>/.test(line)?(u=!0,!c&&line.length>1&&(c=!0)):u=!!/^[ \t]*$/.test(line)||c,u?a+=line+"\n":(l+=a+line,a="\n")}/(^|\n)>/.test(a)||(l+=a,a="")}t.startTag=a,t.before=l,t.after&&(t.after=t.after.replace(/^\n?/,"\n")),t.after=t.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(e){return t.endTag=e,""});var p=function(e){var n=e?"> ":"";t.startTag&&(t.startTag=t.startTag.replace(/\n((>|\s)*)\n$/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"})),t.endTag&&(t.endTag=t.endTag.replace(/^\n((>|\s)*)\n/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"}))};/^(?![ ]{0,3}>)/m.test(t.selection)?(r.wrap(t,e.wmd_env.lineLength-2),t.selection=t.selection.replace(/^/gm,"> "),p(!0),t.addBlankLines()):(t.selection=t.selection.replace(/^[ ]{0,3}> ?/gm,""),r.unwrap(t),p(!1),!/^(\n|^)[ ]{0,3}>/.test(t.selection)&&t.startTag&&(t.startTag=t.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(t.selection)&&t.endTag&&(t.endTag=t.endTag.replace(/^\n{0,2}/,"\n\n"))),/\n/.test(t.selection)||(t.selection=t.selection.replace(/^(> *)/,function(e,n){return t.startTag+=n,""}))},r.doCode=function(e,t,n){var i=/\S[ ]*$/.test(e.before);if(!/^[ ]*\S/.test(e.after)&&!i||/\n/.test(e.selection)){e.before=e.before.replace(/[ ]{4}$/,function(t){return e.selection=t+e.selection,""});var o=1,a=1;(/\n(\t|[ ]{4,}).*\n$/.test(e.before)||""===e.after)&&(o=0),/^\n(\t|[ ]{4,})/.test(e.after)&&(a=0),e.addBlankLines(o,a),e.selection?/^[ ]{0,3}\S/m.test(e.selection)?e.selection=e.selection.replace(/^/gm,"    "):e.selection=e.selection.replace(/^[ ]{4}/gm,""):(e.startTag="    ",e.selection=n?"enter code here":"")}else e.trimWhitespace(),e.findTags(/`/,/`/),e.startTag||e.endTag?e.endTag&&!e.startTag?(e.before+=e.endTag,e.endTag=""):e.startTag=e.endTag="":(e.startTag=e.endTag="`",e.selection||(e.selection=n?"enter code here":""))},r.doList=function(t,i,o,a){var l=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,s="-",c=1,d=function(){var e;return o?(e=" "+c+". ",c++):e=" "+s+" ",e},u=function(e){return void 0===o&&(o=/^\s*\d/.test(e)),e=e.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(e){return d()})};if(t.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!t.before||/\n$/.test(t.before)||/^\n/.test(t.startTag)||(t.before+=t.startTag,t.startTag=""),t.startTag){var p=/\d+[.]/.test(t.startTag);if(t.startTag="",t.selection=t.selection.replace(/\n[ ]{4}/g,"\n"),r.unwrap(t),t.addBlankLines(),p&&(t.after=t.after.replace(l,u)),o==p)return}var f=1;t.before=t.before.replace(/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,function(e){return/^\s*([*+-])/.test(e)&&(s=n.$1),f=/[^\n]\n\n[^\n]/.test(e)?1:0,u(e)}),t.selection||(t.selection=a?"List item":" ");var h=d(),m=1;t.after=t.after.replace(l,function(e){return m=/[^\n]\n\n[^\n]/.test(e)?1:0,u(e)}),t.trimWhitespace(!0),t.addBlankLines(f,m,!0),t.startTag=h;var g=h.replace(/./g," ");r.wrap(t,e.wmd_env.lineLength-g.length),t.selection=t.selection.replace(/\n/g,"\n"+g)},r.doHeading=function(t,i,o){if(t.selection=t.selection.replace(/\s+/g," "),t.selection=t.selection.replace(/(^\s+|\s+$)/g,""),!t.selection)return t.startTag="## ",t.selection="Heading",void(t.endTag=" ##");var a=0;t.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(t.startTag)&&(a=n.lastMatch.length),t.startTag=t.endTag="",t.findTags(null,/\s?(-+|=+)/),/=+/.test(t.endTag)&&(a=1),/-+/.test(t.endTag)&&(a=2),t.startTag=t.endTag="",t.addBlankLines(1,1);var r=0==a?2:a-1;if(r>0){var l=r>=2?"-":"=",s=t.selection.length;for(s>e.wmd_env.lineLength&&(s=e.wmd_env.lineLength),t.endTag="\n";s--;)t.endTag+=l}},r.doHorizontalRule=function(e,t,n){e.startTag="----------\n",e.selection="",e.addBlankLines(2,1,!0)}},Attacklab.wmd_env={},Attacklab.account_options={},Attacklab.wmd_defaults={version:1,output:"HTML",lineLength:40,delayLoad:!1},Attacklab.wmd||(Attacklab.wmd=function(){Attacklab.loadEnv=function(){var e=function(e){if(e)for(var t in e)Attacklab.wmd_env[t]=e[t]};e(Attacklab.wmd_defaults),e(Attacklab.account_options),e(top.wmd_options),Attacklab.full=!0;Attacklab.wmd_env.buttons=Attacklab.wmd_env.buttons||"bold italic link blockquote code image ol ul heading hr"},Attacklab.loadEnv()},Attacklab.wmd(),Attacklab.wmdBase(),Attacklab.Util.startEditor());